"use strict";(self.webpackChunkmantis_material_react=self.webpackChunkmantis_material_react||[]).push([[23],{23:(e,i,n)=>{n.r(i),n.d(i,{default:()=>Z});var s=n(9950),t=n(28429),d=n(14857),r=n(60899),o=n(93230),l=n(19647),c=n(25979),a=n(8145),u=n(70006),x=n(16491),h=n(23266),m=n(24516),j=n(82053),v=n(18216),A=n(1320),p=n(15769),y=n(69780),g=n(9213),f=n(68605),I=n(34075),b=n(74745),w=n(6266),_=n(81831),C=n(31655),q=n(34102),D=n(67956),S=n(43974),M=n(45818),N=n(29714),k=n(44967),P=n(94826),F=n(1587),O=n(29735),$=n(51707),L=n(91290),T=n(16243),z=n(65733),B=n(91807),V=n(27035),E=n(24513),H=n(8750),R=n(44414);const U=N.Ik({date:N.p6().required("Invoice date is required"),due_date:N.p6().when("date",((e,i)=>e&&i.min(e,"Due date can't be before invoice date"))).nullable().required("Due date is required"),customerInfo:N.Ik({name:N.Yj().required("Invoice receiver information is required")}).required("Invoice receiver information is required"),status:N.Yj().required("Status selection is required"),invoice_detail:N.YO().required("Invoice details is required").of(N.Ik().shape({name:N.Yj().required("Product name is required")})).min(1,"Invoice must have at least 1 items")}),W={name:"",address:"",phone:"",email:""},Y=e=>{let{list:i,invoiceMaster:n}=e;const s=(0,d.A)(),N=(0,t.Zp)();return(0,R.jsx)(M.l1,{enableReinitialize:!0,initialValues:{id:i.id||"",invoice_id:i.invoice_id||"",status:i.status||"",date:new Date(i.date)||null,due_date:new Date(i.due_date)||null,cashierInfo:i.cashierInfo||W,customerInfo:i.customerInfo||W,invoice_detail:i.invoice_detail||[],discount:i.discount||0,tax:i.tax||0,notes:i.notes||""},validationSchema:U,onSubmit:e=>{(e=>{var n,s,t;const d={id:Number(i.id),invoice_id:Number(e.invoice_id),customer_name:null===(n=e.cashierInfo)||void 0===n?void 0:n.name,email:null===(s=e.cashierInfo)||void 0===s?void 0:s.email,avatar:Number(i.avatar),discount:Number(e.discount),tax:Number(e.tax),date:(0,S.A)(new Date(e.date),"MM/dd/yyyy"),due_date:(0,S.A)(new Date(e.due_date),"MM/dd/yyyy"),quantity:Number(null===(t=e.invoice_detail)||void 0===t?void 0:t.reduce(((e,i)=>e+i.qty),0)),status:e.status,cashierInfo:e.cashierInfo,customerInfo:e.customerInfo,invoice_detail:e.invoice_detail,notes:e.notes};(0,z.Dq)(d.id,d),(0,B.aN)({open:!0,message:"Invoice Updated successfully",anchorOrigin:{vertical:"top",horizontal:"right"},variant:"alert",alert:{color:"success"},close:!0}),N("/apps/invoice/list")})(e)},children:e=>{var i,t,d,S,N,P,F,T,B,V;let{handleBlur:U,errors:W,handleChange:Y,handleSubmit:Z,values:G,isValid:Q,setFieldValue:J,touched:K}=e;const X=(null===G||void 0===G||null===(i=G.invoice_detail)||void 0===i?void 0:i.reduce(((e,i)=>i.name.trim().length>0?e+Number(i.price*Math.floor(i.qty)):e),0))||0,ee=(null===G||void 0===G?void 0:G.tax)*X/100,ie=G.discount*X/100,ne=X-ie+ee;return(0,R.jsx)(M.lV,{onSubmit:Z,children:(0,R.jsxs)(r.Ay,{container:!0,spacing:2,children:[(0,R.jsx)(r.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,R.jsxs)(o.A,{spacing:1,children:[(0,R.jsx)(l.A,{children:"Invoice Id"}),(0,R.jsx)(c.A,{sx:{width:"100%"},children:(0,R.jsx)(a.A,{required:!0,disabled:!0,type:"number",name:"invoice_id",id:"invoice_id",value:G.invoice_id,onChange:Y})})]})}),(0,R.jsxs)(r.Ay,{item:!0,xs:12,sm:6,md:3,children:[(0,R.jsxs)(o.A,{spacing:1,children:[(0,R.jsx)(l.A,{children:"Status"}),(0,R.jsx)(c.A,{sx:{width:"100%"},children:(0,R.jsxs)(u.A,{value:G.status,displayEmpty:!0,name:"status",renderValue:e=>0===e.length?(0,R.jsx)(x.A,{sx:{color:"secondary.400"},children:"Select status"}):e,onChange:Y,error:Boolean(W.status&&K.status),children:[(0,R.jsx)(h.A,{disabled:!0,value:"",children:"Select status"}),(0,R.jsx)(h.A,{value:"Paid",children:"Paid"}),(0,R.jsx)(h.A,{value:"Unpaid",children:"Unpaid"}),(0,R.jsx)(h.A,{value:"Cancelled",children:"Cancelled"})]})})]}),K.status&&W.status&&(0,R.jsx)(m.A,{error:!0,children:W.status})]}),(0,R.jsxs)(r.Ay,{item:!0,xs:12,sm:6,md:3,children:[(0,R.jsxs)(o.A,{spacing:1,children:[(0,R.jsx)(l.A,{children:"Date"}),(0,R.jsx)(c.A,{sx:{width:"100%"},error:Boolean(K.date&&W.date),children:(0,R.jsx)(_.$,{dateAdapter:q.h,children:(0,R.jsx)(C.l,{format:"dd/MM/yyyy",value:G.date,onChange:e=>J("date",e)})})})]}),K.date&&W.date&&(0,R.jsx)(m.A,{error:!0,children:W.date})]}),(0,R.jsxs)(r.Ay,{item:!0,xs:12,sm:6,md:3,children:[(0,R.jsxs)(o.A,{spacing:1,children:[(0,R.jsx)(l.A,{children:"Due Date"}),(0,R.jsx)(c.A,{sx:{width:"100%"},error:Boolean(K.due_date&&W.due_date),children:(0,R.jsx)(_.$,{dateAdapter:q.h,children:(0,R.jsx)(C.l,{format:"dd/MM/yyyy",value:G.due_date,onChange:e=>J("due_date",e)})})})]}),K.due_date&&W.due_date&&(0,R.jsx)(m.A,{error:!0,children:W.due_date})]}),(0,R.jsx)(r.Ay,{item:!0,xs:12,sm:6,children:(0,R.jsx)(k.A,{sx:{minHeight:168},children:(0,R.jsxs)(r.Ay,{container:!0,spacing:2,children:[(0,R.jsx)(r.Ay,{item:!0,xs:12,sm:8,children:(0,R.jsxs)(o.A,{spacing:2,children:[(0,R.jsx)(j.A,{variant:"h5",children:"From:"}),(0,R.jsxs)(o.A,{sx:{width:"100%"},children:[(0,R.jsx)(j.A,{variant:"subtitle1",children:null===G||void 0===G||null===(t=G.cashierInfo)||void 0===t?void 0:t.name}),(0,R.jsx)(j.A,{color:"secondary",children:null===G||void 0===G||null===(d=G.cashierInfo)||void 0===d?void 0:d.address}),(0,R.jsx)(j.A,{color:"secondary",children:null===G||void 0===G||null===(S=G.cashierInfo)||void 0===S?void 0:S.phone}),(0,R.jsx)(j.A,{color:"secondary",children:null===G||void 0===G||null===(N=G.cashierInfo)||void 0===N?void 0:N.email})]})]})}),(0,R.jsx)(r.Ay,{item:!0,xs:12,sm:4,children:(0,R.jsxs)(x.A,{textAlign:{xs:"left",sm:"right"},color:"grey.200",children:[(0,R.jsx)(v.A,{variant:"outlined",startIcon:(0,R.jsx)(E.A,{}),color:"secondary",onClick:()=>(0,z.tv)(!0),size:"small",children:"Change"}),(0,R.jsx)(L.A,{open:n.open,setOpen:e=>(0,z.tv)(e),handlerAddress:e=>J("cashierInfo",e)})]})})]})})}),(0,R.jsxs)(r.Ay,{item:!0,xs:12,sm:6,children:[(0,R.jsx)(k.A,{sx:{minHeight:168},children:(0,R.jsxs)(r.Ay,{container:!0,spacing:2,children:[(0,R.jsx)(r.Ay,{item:!0,xs:12,sm:8,children:(0,R.jsxs)(o.A,{spacing:2,children:[(0,R.jsx)(j.A,{variant:"h5",children:"To:"}),(0,R.jsxs)(o.A,{sx:{width:"100%"},children:[(0,R.jsx)(j.A,{variant:"subtitle1",children:null===G||void 0===G||null===(P=G.customerInfo)||void 0===P?void 0:P.name}),(0,R.jsx)(j.A,{color:"secondary",children:null===G||void 0===G||null===(F=G.customerInfo)||void 0===F?void 0:F.address}),(0,R.jsx)(j.A,{color:"secondary",children:null===G||void 0===G||null===(T=G.customerInfo)||void 0===T?void 0:T.phone}),(0,R.jsx)(j.A,{color:"secondary",children:null===G||void 0===G||null===(B=G.customerInfo)||void 0===B?void 0:B.email})]})]})}),(0,R.jsx)(r.Ay,{item:!0,xs:12,sm:4,children:(0,R.jsxs)(x.A,{textAlign:"right",color:"grey.200",children:[(0,R.jsx)(v.A,{size:"small",startIcon:(0,R.jsx)(H.A,{}),color:"secondary",variant:"outlined",onClick:()=>(0,z.m$)(!0),children:"Add"}),(0,R.jsx)(L.A,{open:n.isCustomerOpen,setOpen:e=>(0,z.m$)(e),handlerAddress:e=>J("customerInfo",e)})]})})]})}),K.customerInfo&&W.customerInfo&&(0,R.jsx)(m.A,{error:!0,children:null===W||void 0===W||null===(V=W.customerInfo)||void 0===V?void 0:V.name})]}),(0,R.jsx)(r.Ay,{item:!0,xs:12,children:(0,R.jsx)(j.A,{variant:"h5",children:"Detail"})}),(0,R.jsx)(r.Ay,{item:!0,xs:12,children:(0,R.jsx)(M.ED,{name:"invoice_detail",render:e=>{var i,t,d,c,u,h;let{remove:w,push:_}=e;return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(A.A,{children:(0,R.jsxs)(p.A,{sx:{minWidth:650},children:[(0,R.jsx)(y.A,{children:(0,R.jsxs)(g.A,{children:[(0,R.jsx)(f.A,{children:"#"}),(0,R.jsx)(f.A,{children:"Name"}),(0,R.jsx)(f.A,{children:"Description"}),(0,R.jsx)(f.A,{children:"Qty"}),(0,R.jsx)(f.A,{children:"Price"}),(0,R.jsx)(f.A,{align:"right",children:"Amount"}),(0,R.jsx)(f.A,{align:"center",children:"Action"})]})}),(0,R.jsx)(I.A,{children:null===G||void 0===G||null===(i=G.invoice_detail)||void 0===i?void 0:i.map(((e,i)=>(0,R.jsxs)(g.A,{children:[(0,R.jsx)(f.A,{children:(null===G||void 0===G?void 0:G.invoice_detail.indexOf(e))+1}),(0,R.jsx)(O.A,{id:e.id,index:i,name:e.name,description:e.description,qty:e.qty,price:e.price,onDeleteItem:e=>w(e),onEditItem:Y,Blur:U,errors:W,touched:K},e.id)]},e.id)))})]})}),(0,R.jsx)(b.A,{}),K.invoice_detail&&W.invoice_detail&&!Array.isArray(null===W||void 0===W?void 0:W.invoice_detail)&&(0,R.jsx)(o.A,{direction:"row",justifyContent:"center",sx:{p:1.5},children:(0,R.jsx)(m.A,{error:!0,children:W.invoice_detail})}),(0,R.jsxs)(r.Ay,{container:!0,justifyContent:"space-between",children:[(0,R.jsx)(r.Ay,{item:!0,xs:12,md:8,children:(0,R.jsx)(x.A,{sx:{pt:2.5,pr:2.5,pb:2.5,pl:0},children:(0,R.jsx)(v.A,{color:"primary",startIcon:(0,R.jsx)(H.A,{}),onClick:()=>_({id:(0,D.A)(),name:"",description:"",qty:1,price:"1.00"}),variant:"dashed",sx:{bgcolor:"transparent !important"},children:"Add Item"})})}),(0,R.jsxs)(r.Ay,{item:!0,xs:12,md:4,children:[(0,R.jsxs)(r.Ay,{container:!0,justifyContent:"space-between",spacing:2,sx:{pt:2.5,pb:2.5},children:[(0,R.jsx)(r.Ay,{item:!0,xs:6,children:(0,R.jsxs)(o.A,{spacing:1,children:[(0,R.jsx)(l.A,{children:"Discount(%)"}),(0,R.jsx)(a.A,{type:"number",fullWidth:!0,name:"discount",id:"discount",placeholder:"0.0",value:G.discount,onChange:Y,inputProps:{min:0}})]})}),(0,R.jsx)(r.Ay,{item:!0,xs:6,children:(0,R.jsxs)(o.A,{spacing:1,children:[(0,R.jsx)(l.A,{children:"Tax(%)"}),(0,R.jsx)(a.A,{type:"number",fullWidth:!0,name:"tax",id:"tax",placeholder:"0.0",value:G.tax,onChange:Y,inputProps:{min:0}})]})})]}),(0,R.jsx)(r.Ay,{item:!0,xs:12,children:(0,R.jsxs)(o.A,{spacing:2,children:[(0,R.jsxs)(o.A,{direction:"row",justifyContent:"space-between",children:[(0,R.jsx)(j.A,{color:s.palette.grey[500],children:"Sub Total:"}),(0,R.jsx)(j.A,{children:(null===(t=n.country)||void 0===t?void 0:t.prefix)+""+X.toFixed(2)})]}),(0,R.jsxs)(o.A,{direction:"row",justifyContent:"space-between",children:[(0,R.jsx)(j.A,{color:s.palette.grey[500],children:"Discount:"}),(0,R.jsx)(j.A,{variant:"h6",color:s.palette.success.main,children:(null===(d=n.country)||void 0===d?void 0:d.prefix)+""+ie.toFixed(2)})]}),(0,R.jsxs)(o.A,{direction:"row",justifyContent:"space-between",children:[(0,R.jsx)(j.A,{color:s.palette.grey[500],children:"Tax:"}),(0,R.jsx)(j.A,{children:(null===(c=n.country)||void 0===c?void 0:c.prefix)+""+ee.toFixed(2)})]}),(0,R.jsxs)(o.A,{direction:"row",justifyContent:"space-between",children:[(0,R.jsx)(j.A,{variant:"subtitle1",children:"Grand Total:"}),(0,R.jsx)(j.A,{variant:"subtitle1",children:ne%1===0?(null===(u=n.country)||void 0===u?void 0:u.prefix)+""+ne:(null===(h=n.country)||void 0===h?void 0:h.prefix)+""+ne.toFixed(2)})]})]})})]})]})]})}})}),(0,R.jsx)(r.Ay,{item:!0,xs:12,children:(0,R.jsxs)(o.A,{spacing:1,children:[(0,R.jsx)(l.A,{children:"Notes"}),(0,R.jsx)(a.A,{placeholder:"Address",rows:3,value:G.notes,multiline:!0,name:"notes",onChange:Y,inputProps:{maxLength:500},helperText:`${G.notes.length} / 500`,sx:{width:"100%","& .MuiFormHelperText-root":{mr:0,display:"flex",justifyContent:"flex-end"}}})]})}),(0,R.jsx)(r.Ay,{item:!0,xs:12,sm:6,children:(0,R.jsxs)(o.A,{spacing:1,children:[(0,R.jsx)(l.A,{children:"Set Currency*"}),(0,R.jsx)(c.A,{sx:{width:{xs:"100%",sm:250}},children:(0,R.jsx)(w.A,{id:"country-select-demo",fullWidth:!0,options:n.countries,defaultValue:n.countries[2],value:n.countries.find((e=>{var i;return e.code===(null===(i=n.country)||void 0===i?void 0:i.code)})),onChange:(e,i)=>(0,z.PZ)(i),autoHighlight:!0,getOptionLabel:e=>e.label,renderOption:(e,i)=>(0,R.jsxs)(x.A,{component:"li",sx:{"& > img":{mr:2,flexShrink:0}},...e,children:[i.code&&(0,R.jsx)("img",{loading:"lazy",width:"20",src:`https://flagcdn.com/w20/${i.code.toLowerCase()}.png`,srcSet:`https://flagcdn.com/w40/${i.code.toLowerCase()}.png 2x`,alt:""}),i.label]}),renderInput:e=>{const i=n.countries.find((e=>{var i;return e.code===(null===(i=n.country)||void 0===i?void 0:i.code)}));return(0,R.jsx)(a.A,{...e,name:"phoneCode",placeholder:"Select",InputProps:{...e.InputProps,startAdornment:(0,R.jsx)(R.Fragment,{children:i&&""!==i.code&&(0,R.jsx)("img",{style:{marginRight:6},loading:"lazy",width:"20",src:`https://flagcdn.com/w20/${i.code.toLowerCase()}.png`,srcSet:`https://flagcdn.com/w40/${i.code.toLowerCase()}.png 2x`,alt:""})})},inputProps:{...e.inputProps,autoComplete:"new-password"}})}})})]})}),(0,R.jsx)(r.Ay,{item:!0,xs:12,sm:6,children:(0,R.jsxs)(o.A,{direction:"row",justifyContent:"flex-end",alignItems:"flex-end",spacing:2,sx:{height:"100%"},children:[(0,R.jsx)(v.A,{variant:"outlined",color:"secondary",disabled:!Q,sx:{color:"secondary.dark"},onClick:()=>(0,z.Nm)(!0),children:"Preview"}),(0,R.jsx)(v.A,{color:"primary",variant:"contained",type:"submit",children:"Update & Send"}),(0,R.jsx)($.A,{isOpen:n.isOpen,setIsOpen:e=>(0,z.Nm)(e),invoiceInfo:{...G,subtotal:X,taxRate:ee,discountRate:ie,total:ne},items:null===G||void 0===G?void 0:G.invoice_detail,onAddNextInvoice:()=>(0,z.Nm)(!1)},G.invoice_id)]})})]})})}})},Z=()=>{const{id:e}=(0,t.g)(),{menuMaster:i}=(0,V.DF)(),{invoiceLoading:n,invoice:d}=(0,z.hl)(),{invoiceMaster:r,invoiceMasterLoading:o}=(0,z.Be)(),[l,c]=(0,s.useState)(null);(0,s.useEffect)((()=>{"invoice-edit"!==i.openedItem&&(0,V.qx)("invoice-edit"),e&&!n&&c(d.filter((i=>i.id.toString()===e))[0])}),[e,n]);const a=(0,R.jsx)(x.A,{sx:{height:"calc(100vh - 310px)"},children:(0,R.jsx)(P.A,{})});let u=[{title:"Home",to:T.qm},{title:"Invoice",to:"/apps/invoice/dashboard"},{title:"Edit"}];const h=n||o||void 0===r||null===l;return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(F.A,{custom:!0,heading:"New Invoice",links:u}),(0,R.jsx)(k.A,{children:h?a:(0,R.jsx)(Y,{list:l,invoiceMaster:r})})]})}}}]);