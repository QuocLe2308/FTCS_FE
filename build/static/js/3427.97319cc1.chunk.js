"use strict";(self.webpackChunkmantis_material_react=self.webpackChunkmantis_material_react||[]).push([[3427],{3427:(e,i,t)=>{t.r(i),t.d(i,{default:()=>he});var n=t(9950),r=t(28429),o=t(42074),s=t(14857),a=t(93230),l=t(18216),c=t(1320),d=t(15769),h=t(69780),g=t(9213),p=t(68605),x=t(16491),u=t(34075),A=t(74745),j=t(25979),m=t(70006),k=t(23266),y=t(82053),b=t(25277),B=t(53065),D=t(65313),I=t(44967),C=t(86263),f=t(32778),v=t(16304),T=t(41394),S=t(65123),w=t(8750),L=t(24513),E=t(44070),M=t(29120),P=t(40033),R=t(28170),N=t(60899),F=t(19647),W=t(8145),V=t(2660),K=t(83563),q=t(24516),_=t(79739),z=t(45818),O=t(29714),G=t(81831),H=t(34102),Y=t(89400),$=t(91807),X=t(96583),Q=t(37476),U=t(46007),Z=t(36256),J=t(44414);const ee=e=>{let{id:i,open:t,handleClose:n}=e;return(0,J.jsx)(X.A,{open:t,onClose:n,keepMounted:!0,TransitionComponent:Q.s,maxWidth:"xs","aria-labelledby":"tripBooking-delete-title","aria-describedby":"tripBooking-delete-description",children:(0,J.jsx)(R.A,{sx:{mt:2,my:1},children:(0,J.jsxs)(a.A,{alignItems:"center",spacing:3.5,children:[(0,J.jsx)(U.A,{color:"error",sx:{width:72,height:72,fontSize:"1.75rem"},children:(0,J.jsx)(Z.A,{})}),(0,J.jsxs)(a.A,{spacing:2,children:[(0,J.jsx)(y.A,{variant:"h4",align:"center",children:"B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n x\xf3a chuy\u1ebfn \u0111i n\xe0y kh\xf4ng?"}),(0,J.jsx)(y.A,{align:"center",children:"B\u1ea1n s\u1ebd kh\xf4ng th\u1ec3 kh\xf4i ph\u1ee5c l\u1ea1i sau khi x\xf3a. B\u1ea1n c\xf3 mu\u1ed1n ti\u1ebfp t\u1ee5c kh\xf4ng?"})]}),(0,J.jsxs)(a.A,{direction:"row",spacing:2,sx:{width:1},children:[(0,J.jsx)(l.A,{fullWidth:!0,onClick:n,color:"secondary",variant:"outlined",children:"H\u1ee7y"}),(0,J.jsx)(l.A,{fullWidth:!0,color:"error",variant:"contained",onClick:async()=>{await(0,S.iI)(i).then((()=>{(0,$.aN)({open:!0,message:"X\xf3a th\xe0nh c\xf4ng!",anchorOrigin:{vertical:"top",horizontal:"right"},variant:"alert",alert:{color:"success"}}),n()}))},autoFocus:!0,children:"X\xf3a"})]})]})})})},ie=e=>{const i={accountId:0,tripAgreementId:null,bookingType:"Round-trip",bookingDate:new Date,pickupLocation:"",dropoffLocation:"",startLocationAddress:"",endLocationAddress:"",capacity:0,status:"ARRANGING_DRIVER",paymentMethod:"ONLINE_PAYMENT",expirationDate:new Date,totalDistance:0,price:0,notes:""};return e?{...i,...e}:i},te=["ARRANGING_DRIVER","DRIVER_ON_THE_WAY","DELIVERED","ORDER_COMPLETED","CANCELLED"],ne=["ONLINE_PAYMENT","CASH"],re=["One-way","Round-trip"],oe=e=>{let{tripBooking:i,closeModal:t}=e;const[r,o]=(0,n.useState)(!1),s=O.Ik().shape({accountId:O.ai().required("Account ID is required"),startLocationAddress:O.Yj().required("Start Location Address is required"),endLocationAddress:O.Yj().required("End Location Address is required"),bookingDate:O.p6().required("Booking Date is required"),expirationDate:O.p6().required("Expiration Date is required").min(O.KR("bookingDate"),"Expiration Date must be after Booking Date"),capacity:O.ai().min(0,"Capacity must be non-negative"),status:O.Yj().required("Status is required"),paymentMethod:O.Yj().required("Payment Method is required"),bookingType:O.Yj().required("Booking Type is required")}),c=(0,z.Wx)({initialValues:ie(i),validationSchema:s,enableReinitialize:!0,onSubmit:async(e,n)=>{let{setSubmitting:r}=n;try{const n=i?(0,S.ky)(i.bookingId,e):(0,S.Gj)(e);await n.then((()=>{(0,$.aN)({open:!0,message:i?"Trip Booking updated successfully.":"Trip Booking added successfully.",variant:"alert",alert:{color:"success"}}),r(!1),t()}))}catch(o){console.error("Error submitting trip booking:",o),(0,$.aN)({open:!0,message:"Failed to save trip booking. Please try again.",variant:"alert",alert:{color:"error"}}),r(!1)}}}),{errors:d,touched:h,handleSubmit:g,isSubmitting:p,getFieldProps:x,setFieldValue:u}=c;return(0,J.jsxs)(z.QI,{value:c,children:[(0,J.jsx)(G.$,{dateAdapter:H.h,children:(0,J.jsxs)(z.lV,{autoComplete:"off",noValidate:!0,onSubmit:g,children:[(0,J.jsx)(P.A,{children:i?"Edit Trip Booking":"New Trip Booking"}),(0,J.jsx)(A.A,{}),(0,J.jsx)(R.A,{sx:{p:2.5},children:(0,J.jsxs)(N.Ay,{container:!0,spacing:3,children:[(0,J.jsx)(N.Ay,{item:!0,xs:12,sm:6,children:(0,J.jsxs)(a.A,{spacing:1,children:[(0,J.jsx)(F.A,{htmlFor:"tripBooking-accountId",children:"Account ID"}),(0,J.jsx)(W.A,{fullWidth:!0,id:"tripBooking-accountId",type:"number",...x("accountId"),error:Boolean(h.accountId&&d.accountId),helperText:h.accountId&&d.accountId})]})}),(0,J.jsx)(N.Ay,{item:!0,xs:12,sm:6,children:(0,J.jsxs)(a.A,{spacing:1,children:[(0,J.jsx)(F.A,{htmlFor:"tripBooking-tripAgreementId",children:"Trip Agreement ID"}),(0,J.jsx)(W.A,{fullWidth:!0,id:"tripBooking-tripAgreementId",type:"number",...x("tripAgreementId"),error:Boolean(h.tripAgreementId&&d.tripAgreementId),helperText:h.tripAgreementId&&d.tripAgreementId})]})}),(0,J.jsx)(N.Ay,{item:!0,xs:12,sm:6,children:(0,J.jsxs)(a.A,{spacing:1,children:[(0,J.jsx)(F.A,{htmlFor:"tripBooking-bookingType",children:"Booking Type"}),(0,J.jsxs)(j.A,{fullWidth:!0,children:[(0,J.jsx)(m.A,{id:"tripBooking-bookingType",...x("bookingType"),onChange:e=>u("bookingType",e.target.value),input:(0,J.jsx)(V.A,{}),renderValue:e=>(0,J.jsx)(y.A,{children:e}),children:re.map((e=>(0,J.jsx)(k.A,{value:e,children:(0,J.jsx)(K.A,{primary:e})},e)))}),h.bookingType&&d.bookingType&&(0,J.jsx)(q.A,{error:!0,children:d.bookingType})]})]})}),(0,J.jsx)(N.Ay,{item:!0,xs:12,sm:6,children:(0,J.jsxs)(a.A,{spacing:1,children:[(0,J.jsx)(F.A,{htmlFor:"tripBooking-status",children:"Status"}),(0,J.jsxs)(j.A,{fullWidth:!0,children:[(0,J.jsx)(m.A,{id:"tripBooking-status",...x("status"),onChange:e=>u("status",e.target.value),input:(0,J.jsx)(V.A,{}),renderValue:e=>(0,J.jsx)(y.A,{children:e}),children:te.map((e=>(0,J.jsx)(k.A,{value:e,children:(0,J.jsx)(K.A,{primary:e})},e)))}),h.status&&d.status&&(0,J.jsx)(q.A,{error:!0,children:d.status})]})]})}),(0,J.jsx)(N.Ay,{item:!0,xs:12,children:(0,J.jsxs)(a.A,{spacing:1,children:[(0,J.jsx)(F.A,{htmlFor:"tripBooking-startLocationAddress",children:"Start Location Address"}),(0,J.jsx)(W.A,{fullWidth:!0,id:"tripBooking-startLocationAddress",multiline:!0,rows:2,...x("startLocationAddress"),error:Boolean(h.startLocationAddress&&d.startLocationAddress),helperText:h.startLocationAddress&&d.startLocationAddress})]})}),(0,J.jsx)(N.Ay,{item:!0,xs:12,children:(0,J.jsxs)(a.A,{spacing:1,children:[(0,J.jsx)(F.A,{htmlFor:"tripBooking-endLocationAddress",children:"End Location Address"}),(0,J.jsx)(W.A,{fullWidth:!0,id:"tripBooking-endLocationAddress",multiline:!0,rows:2,...x("endLocationAddress"),error:Boolean(h.endLocationAddress&&d.endLocationAddress),helperText:h.endLocationAddress&&d.endLocationAddress})]})}),(0,J.jsx)(N.Ay,{item:!0,xs:12,sm:6,children:(0,J.jsxs)(a.A,{spacing:1,children:[(0,J.jsx)(F.A,{htmlFor:"tripBooking-bookingDate",children:"Booking Date"}),(0,J.jsx)(Y.K,{value:c.values.bookingDate,onChange:e=>u("bookingDate",e),slotProps:{textField:{fullWidth:!0,error:Boolean(h.bookingDate&&d.bookingDate),helperText:h.bookingDate&&d.bookingDate}}})]})}),(0,J.jsx)(N.Ay,{item:!0,xs:12,sm:6,children:(0,J.jsxs)(a.A,{spacing:1,children:[(0,J.jsx)(F.A,{htmlFor:"tripBooking-expirationDate",children:"Expiration Date"}),(0,J.jsx)(Y.K,{value:c.values.expirationDate,onChange:e=>u("expirationDate",e),slotProps:{textField:{fullWidth:!0,error:Boolean(h.expirationDate&&d.expirationDate),helperText:h.expirationDate&&d.expirationDate}}})]})}),(0,J.jsx)(N.Ay,{item:!0,xs:12,sm:6,children:(0,J.jsxs)(a.A,{spacing:1,children:[(0,J.jsx)(F.A,{htmlFor:"tripBooking-capacity",children:"Capacity"}),(0,J.jsx)(W.A,{fullWidth:!0,id:"tripBooking-capacity",type:"number",...x("capacity"),error:Boolean(h.capacity&&d.capacity),helperText:h.capacity&&d.capacity})]})}),(0,J.jsx)(N.Ay,{item:!0,xs:12,sm:6,children:(0,J.jsxs)(a.A,{spacing:1,children:[(0,J.jsx)(F.A,{htmlFor:"tripBooking-paymentMethod",children:"Payment Method"}),(0,J.jsxs)(j.A,{fullWidth:!0,children:[(0,J.jsx)(m.A,{id:"tripBooking-paymentMethod",...x("paymentMethod"),onChange:e=>u("paymentMethod",e.target.value),input:(0,J.jsx)(V.A,{}),renderValue:e=>(0,J.jsx)(y.A,{children:e}),children:ne.map((e=>(0,J.jsx)(k.A,{value:e,children:(0,J.jsx)(K.A,{primary:e})},e)))}),h.paymentMethod&&d.paymentMethod&&(0,J.jsx)(q.A,{error:!0,children:d.paymentMethod})]})]})}),(0,J.jsx)(N.Ay,{item:!0,xs:12,children:(0,J.jsxs)(a.A,{spacing:1,children:[(0,J.jsx)(F.A,{htmlFor:"tripBooking-notes",children:"Notes"}),(0,J.jsx)(W.A,{fullWidth:!0,id:"tripBooking-notes",multiline:!0,rows:2,...x("notes"),error:Boolean(h.notes&&d.notes),helperText:h.notes&&d.notes})]})})]})}),(0,J.jsx)(A.A,{}),(0,J.jsx)(_.A,{sx:{p:2.5},children:(0,J.jsxs)(N.Ay,{container:!0,justifyContent:"space-between",alignItems:"center",children:[(0,J.jsx)(N.Ay,{item:!0,children:i&&(0,J.jsx)(C.A,{onClick:()=>o(!0),size:"large",color:"error",children:(0,J.jsx)(Z.A,{})})}),(0,J.jsx)(N.Ay,{item:!0,children:(0,J.jsxs)(a.A,{direction:"row",spacing:2,children:[(0,J.jsx)(l.A,{color:"error",onClick:t,children:"Cancel"}),(0,J.jsx)(l.A,{type:"submit",variant:"contained",disabled:p,children:i?"Edit":"Add"})]})})]})})]})}),i&&(0,J.jsx)(ee,{id:i.bookingId,title:i.bookingId,open:r,handleClose:()=>{o(!r),t()}})]})};var se=t(41492),ae=t(65182);const le=e=>{let{open:i,modalToggler:t,tripBooking:r}=e;const{tripBookingsLoading:o}=(0,S.dv)(),s=()=>t(!1),l=(0,n.useMemo)((()=>!o&&(0,J.jsx)(oe,{tripBooking:r||null,closeModal:s})),[r,o]);return(0,J.jsx)(J.Fragment,{children:i&&(0,J.jsx)(M.A,{open:i,onClose:s,"aria-labelledby":"modal-tripBooking-add-label","aria-describedby":"modal-tripBooking-add-description",sx:{"& .MuiPaper-root:focus":{outline:"none"}},children:(0,J.jsx)(I.A,{sx:{width:"calc(100% - 48px)",minWidth:340,maxWidth:880,height:"auto",maxHeight:"calc(100vh - 48px)"},modal:!0,content:!1,children:(0,J.jsx)(se.A,{sx:{maxHeight:"calc(100vh - 48px)","& .simplebar-content":{display:"flex",flexDirection:"column"}},children:o?(0,J.jsx)(x.A,{sx:{p:5},children:(0,J.jsx)(a.A,{direction:"row",justifyContent:"center",children:(0,J.jsx)(ae.A,{})})}):l})})})})};var ce=t(35346);function de(e){let{data:i,columns:t,modalToggler:r,totalPages:o,currentPage:s,onPageChange:y,pageSize:b,onPageSizeChange:B}=e;const[C,S]=(0,n.useState)([{id:"bookingId",desc:!0}]),[L,E]=(0,n.useState)(""),M=(0,f.N4)({data:i,columns:t,state:{sorting:C,globalFilter:L},onSortingChange:S,onGlobalFilterChange:E,getCoreRowModel:(0,v.HT)(),getSortedRowModel:(0,v.h5)(),getFilteredRowModel:(0,v.hM)(),manualPagination:!0,pageCount:o,debugTable:!0}),P=t.filter((e=>e.accessorKey)).map((e=>({label:"string"===typeof e.header?e.header:"#",key:e.accessorKey})));return(0,J.jsxs)(I.A,{content:!1,children:[(0,J.jsxs)(a.A,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",justifyContent:"space-between",sx:{padding:2},children:[(0,J.jsx)(T.iF,{value:null!==L&&void 0!==L?L:"",onFilterChange:e=>E(String(e)),placeholder:`Search ${i.length} trip bookings...`}),(0,J.jsxs)(a.A,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",children:[(0,J.jsx)(l.A,{variant:"contained",startIcon:(0,J.jsx)(w.A,{}),onClick:r,children:"Th\xeam"}),(0,J.jsx)(T.pK,{data:i,headers:P,filename:"trip-booking-list.csv"})]})]}),(0,J.jsxs)(D.A,{children:[(0,J.jsx)(c.A,{children:(0,J.jsxs)(d.A,{children:[(0,J.jsx)(h.A,{children:M.getHeaderGroups().map((e=>(0,J.jsx)(g.A,{children:e.headers.map((e=>(0,J.jsx)(p.A,{onClick:e.column.getToggleSortingHandler(),sx:{cursor:e.column.getCanSort()?"pointer":"default"},children:(0,J.jsxs)(a.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,J.jsx)(x.A,{children:(0,f.Kv)(e.column.columnDef.header,e.getContext())}),e.column.getCanSort()&&(0,J.jsx)(T.gT,{column:e.column})]})},e.id)))},e.id)))}),(0,J.jsx)(u.A,{children:M.getRowModel().rows.map((e=>(0,J.jsx)(g.A,{children:e.getVisibleCells().map((e=>(0,J.jsx)(p.A,{children:(0,f.Kv)(e.column.columnDef.cell,e.getContext())},e.id)))},e.id)))})]})}),(0,J.jsx)(A.A,{}),(0,J.jsx)(x.A,{sx:{p:2},children:(0,J.jsxs)(a.A,{direction:"row",spacing:2,justifyContent:"space-between",alignItems:"center",sx:{width:"100%"},children:[(0,J.jsx)(x.A,{children:(0,J.jsx)(j.A,{variant:"standard",sx:{minWidth:100},children:(0,J.jsx)(m.A,{value:b,onChange:e=>{const i=Number(e.target.value);B(i)},label:"Rows per page",displayEmpty:!0,inputProps:{"aria-label":"Rows per page"},children:[5,10,25,50].map((e=>(0,J.jsxs)(k.A,{value:e,children:[e," rows"]},e)))})})}),(0,J.jsxs)(a.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,J.jsx)(l.A,{variant:"text",disabled:0===s,onClick:()=>{s>0&&y(s-1)},children:"Previous"}),(0,J.jsxs)(x.A,{children:["Page"," ",(0,J.jsxs)("strong",{children:[s+1," of ",Math.max(1,o)]})]}),(0,J.jsx)(l.A,{variant:"text",disabled:s>=o-1,onClick:()=>{s<o-1&&y(s+1)},children:"Next"})]})]})})]})]})}const he=()=>{const e=(0,s.A)(),i=(0,r.Zp)(),[t]=(0,o.ok)(),[l,c]=(0,n.useState)(parseInt(t.get("page")||"0",10)),[d,h]=(0,n.useState)(parseInt(t.get("size")||"10",10)),[g,p]=(0,n.useState)(!1),[x,u]=(0,n.useState)(!1),[A,j]=(0,n.useState)(!1),[m,k]=(0,n.useState)(null),[D,f]=(0,n.useState)(""),{tripBookings:v,tripBookingsLoading:T,tripBookingsError:w,totalPages:M,currentPage:P,refetch:R}=(0,S.dv)(l,d),N=e=>{const n=new URLSearchParams(t);Object.entries(e).forEach((e=>{let[i,t]=e;null===t||""===t?n.delete(i):n.set(i,t)})),i(`?${n.toString()}`,{replace:!0})},F=()=>u(!x);(0,n.useEffect)((()=>{g&&(R(),p(!1))}),[g,R]);const W=(0,n.useMemo)((()=>[{header:"Booking ID",accessorKey:"bookingId"},{header:"Account ID",accessorKey:"accountId"},{header:"Trip Agreement ID",accessorKey:"tripAgreementId"},{header:"Booking Type",accessorKey:"bookingType"},{header:"\u0110i\u1ec3m \u0111\xf3n",accessorKey:"startLocationAddress",cell:e=>{let{getValue:i}=e;return(0,J.jsx)(y.A,{children:i()})}},{header:"\u0110i\u1ec3m \u0111\u1ebfn",accessorKey:"endLocationAddress",cell:e=>{let{getValue:i}=e;return(0,J.jsx)(y.A,{children:i()})}},{header:"Ng\xe0y \u0111\u1eb7t",accessorKey:"bookingDate",cell:e=>{let{getValue:i}=e;return new Date(i()).toLocaleString()}},{header:"Tr\u1ea1ng th\xe1i",accessorKey:"status",cell:e=>{let{getValue:i}=e;return(0,J.jsx)(b.A,{color:"ORDER_COMPLETED"===i()?"success":"PENDING"===i()?"warning":"info",label:i(),size:"small",variant:"light"})}},{header:"Gi\xe1",accessorKey:"price",cell:e=>{let{getValue:i}=e;return(0,J.jsxs)(y.A,{children:[i().toLocaleString()," VND"]})}},{header:"H\xe0nh \u0111\u1ed9ng",cell:e=>{let{row:i}=e;return(0,J.jsxs)(a.A,{direction:"row",spacing:0,children:[(0,J.jsx)(B.A,{title:"Edit",children:(0,J.jsx)(C.A,{color:"primary",onClick:()=>{k(i.original),j(!0)},children:(0,J.jsx)(L.A,{})})}),(0,J.jsx)(B.A,{title:"Delete",children:(0,J.jsx)(C.A,{color:"error",onClick:()=>{F(),f(i.original.bookingId)},children:(0,J.jsx)(E.A,{})})})]})},enableSorting:!1}]),[e]);return T?(0,J.jsx)(ce.default,{}):w?(0,J.jsxs)(y.A,{children:["Error loading trip bookings: ",w.message]}):(0,J.jsxs)(I.A,{children:[(0,J.jsx)(de,{data:v||[],columns:W,totalPages:M||0,currentPage:P||0,onPageChange:e=>{c(e),N({page:e})},pageSize:d,onPageSizeChange:e=>{h(e),c(0),N({size:e,page:0})},modalToggler:()=>{j(!0),k(null)}}),(0,J.jsx)(ee,{id:D,title:D,open:x,handleClose:F,onDeleteSuccess:()=>p(!0)}),(0,J.jsx)(le,{open:A,modalToggler:j,tripBooking:m,onSuccess:()=>{p(!0),j(!1)}})]})}}}]);